global
    daemon
    log stdout local0
    
defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option httplog
    log global

frontend weather_frontend
    bind *:80
    capture response header X-Server-ID len 32
    
    # Health check endpoint for load balancer
    acl is_lb_health path_beg /lb-health
    use_backend lb_health_backend if is_lb_health
    
    default_backend weather_servers

backend weather_servers
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200
    server web01 weather-web01:8084 check
    server web02 weather-web02:8085 check

backend lb_health_backend
    http-request return status 200 content-type text/plain string "OK"
